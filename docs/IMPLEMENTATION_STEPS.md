# 크롬 익스텐션 기반 암호화폐 자동매매 봇 - 단계별 구현 계획

## 📋 개요
이 문서는 크롬 익스텐션 기반 암호화폐 자동매매 봇을 단계적으로 구현하기 위한 상세 계획입니다. 
각 단계를 명확하게 정의하고, 한 단계씩 완료한 후 다음 단계로 진행합니다.

---

## 🎯 구현 전략
1. **최소 기능으로 시작**: 핵심 기능만 구현하여 동작 확인
2. **단계별 테스트**: 각 단계마다 실제로 테스트하며 진행
3. **점진적 확장**: 기본 기능 완성 후 추가 기능 구현
4. **안정성 우선**: 빠른 개발보다 안정적인 동작 우선

---

## 📝 Phase 1: 기본 구조 설정 (1단계) ✅ 완료
**목표**: 최소한의 파일 구조와 manifest만으로 익스텐션 동작 확인

### 1-1. Manifest 설정
- [x] manifest.json 기본 구조 작성 (사이드 패널 형식)
- [x] 버전, 이름, 설명만 포함
- [x] 빈 popup.html 생성
- [x] 익스텐션 로드 확인

### 1-2. 기본 HTML 구조
- [x] popup.html 작성
- [x] 간단한 "Hello World" 메시지만 표시
- [x] CSS 없이 순수 HTML만

### 1-3. 테스트
- [x] Chrome에 익스텐션 로드
- [x] 사이드 패널이 정상적으로 열리는지 확인
- [x] 콘솔 에러 없는지 확인

**완료 조건**: 익스텐션 사이드 패널이 에러 없이 열림 ✅

---

## 📝 Phase 2: 사이드 패널 UI 구현 (2단계) ✅ 완료
**목표**: 사용자가 볼 수 있는 기본 UI 구현

### 2-1. HTML 구조
- [x] 상태 표시 영역 추가
- [x] 버튼 영역 추가 (거래 시작/중단)
- [x] 간단한 설정 영역 추가
- [x] 거래소 선택 영역 추가

### 2-2. CSS 스타일링
- [x] popup.css 작성
- [x] 기본 색상 및 레이아웃
- [x] 반응형 레이아웃 (가로 스크롤바 제거)

### 2-3. 기본 JavaScript
- [x] popup.js 생성
- [x] 버튼 클릭 이벤트 리스너 추가
- [x] 콘솔에 클릭 로그 출력
- [x] 거래소 선택 및 이동 기능

### 2-4. 테스트
- [x] 모든 버튼이 표시되는지 확인
- [x] 버튼 클릭 시 콘솔 로그 확인
- [x] 레이아웃이 깨지지 않는지 확인

**완료 조건**: UI가 정상적으로 표시되고 버튼이 작동함 ✅

---

## 📝 Phase 3: Chrome APIs 연동 (3단계) ✅ 완료
**목표**: Chrome 확장 API 기본 사용법 익히기

### 3-1. Storage API
- [x] 간단한 데이터 저장/로드 테스트
- [x] 설정값 저장 구현 (거래 주기, 거래소 선택)
- [x] 저장된 값 불러오기

### 3-2. Tabs API
- [x] 현재 활성 탭 확인
- [x] 탭 URL 읽기
- [x] 새 탭 열기 (거래소 이동 기능)

### 3-3. Messages API
- [x] Popup → Background 통신
- [x] 간단한 상태 전달 테스트 (거래 시작/중단)

### 3-4. 테스트
- [x] 각 API가 정상 작동하는지 확인
- [x] 콘솔에 올바른 값 출력되는지 확인

**완료 조건**: Chrome APIs가 정상적으로 작동함 ✅

---

## 📝 Phase 4: Content Script 기본 (4단계) ✅ 완료
**목표**: 웹페이지에 스크립트 주입하여 DOM 조작

### 4-1. Content Script 추가
- [x] manifest.json에 content script 추가
- [x] content.js 생성
- [x] 간단한 DOM 조작 (거래소 감지)

### 4-2. 거래소 페이지 감지
- [x] 현재 페이지 URL 확인
- [x] 거래소 판별 로직 구현 (간소화됨)
- [x] 지원/비지원 페이지 안내 (제거됨)

### 4-3. 기본 통신
- [x] Content → Popup 통신
- [x] Content → Background 통신
- [x] 현재 거래소 정보 전달

### 4-4. 테스트
- [x] 거래소 페이지에서 정상 작동 확인
- [x] 거래소 선택 및 이동 기능 확인
- [x] 메시지 전달 정상 확인

**완료 조건**: 거래소 페이지에서 정상적으로 작동하며 통신 가능 ✅

---

## 📝 Phase 5: 가격 정보 추출 (5단계) ✅ 완료
**목표**: 거래소 페이지에서 가격 정보 읽기

### 5-1. 가격 추출기 구현
- [x] 자본금(Assets) 추출 함수 구현
- [x] 현재가(Price) 추출 함수 구현
- [x] 사용자 지정 셀렉터로 데이터 추출
- [x] Dynamic Script Injection을 통한 안정적인 추출

### 5-2. DOM 선택자 시스템
- [x] 사용자 요소 선택 모드 구현
- [x] 마우스 오버 하이라이트
- [x] 클릭으로 셀렉터 자동 생성
- [x] 셀렉터 저장 및 로드

### 5-3. 가격 업데이트
- [x] 주기적으로 가격 읽기 (기본 1초)
- [x] Popup에 가격 전송
- [x] 데이터 표시 카드에 실시간 업데이트

### 5-4. 추가 기능
- [x] Leverage 입력 및 계산
- [x] Amount 자동 계산 (Assets * Leverage / Price)
- [x] One-Way/Hedge Mode 선택
- [x] Position (%) 설정 기능

### 5-5. 테스트
- [x] 실제 거래소에서 데이터 읽기
- [x] 주기적 업데이트 정상 작동 확인
- [x] 거래 시작/중단 동작 확인

**완료 조건**: 거래소 페이지에서 실제 데이터를 읽어서 팝업에 표시 ✅

---

## 📝 Phase 6: 매크로 녹화 시스템 (6단계) ✅ 완료
**목표**: 사용자가 버튼 위치를 지정하는 시스템

### 6-1. 녹화 모드
- [x] Long Record / Short Record 버튼 구현
- [x] 녹화 상태 표시 (Stop Recording으로 변경)
- [x] 녹화 중 시각적 피드백 (빨간색 표시)
- [x] ESC 키로 녹화 중단 기능

### 6-2. 하이브리드 요소 선택 시스템
- [x] 클릭한 요소 저장 (셀렉터 + 키워드 + 위치)
- [x] 스마트 셀렉터 생성 (Long/Short 버튼 구분)
- [x] 키워드 기반 요소 탐지
- [x] 위치 기반 백업 시스템
- [x] 클릭 유형 분석 (OPEN_TAB, LONG_BUTTON, SHORT_BUTTON 등)

### 6-3. 매크로 저장 및 최적화
- [x] 매크로 데이터 구조 (액션 타입, 셀렉터, 키워드, 위치)
- [x] Chrome Storage에 저장 (longMacro, shortMacro)
- [x] 저장된 매크로 불러오기
- [x] 키보드 입력 최적화 (Amount 필드 자동 대체)
- [x] 이벤트 리스너 최적화 (AbortController 사용)

### 6-4. 성능 최적화
- [x] Content Script 수동 주입 시스템
- [x] 이벤트 리스너 효율적 관리
- [x] 입력 이벤트 쓰로틀링
- [x] 백그라운드 자동 실행 방지

### 6-5. 테스트
- [x] 녹화 기능 정상 작동 확인
- [x] 매크로 저장 확인
- [x] 매크로 재로드 확인
- [x] Long/Short 구분 정확성 확인

**완료 조건**: 매크로를 녹화하고 저장할 수 있음 ✅

---

## 📝 Phase 7: 매크로 실행 (7단계) ✅ 완료
**목표**: 녹화한 매크로 실행

### 7-1. 하이브리드 매크로 실행기
- [x] 저장된 매크로 읽기 (Chrome Storage에서 로드)
- [x] 단계별 실행 (액션별 순차 실행)
- [x] 셀렉터 우선 + 스마트 탐지 백업 시스템
- [x] 텍스트 검증을 통한 Long/Short 버튼 정확성 보장

### 7-2. 스마트 요소 탐지 시스템
- [x] TradingElementDetector 클래스 구현
- [x] 키워드 기반 요소 찾기 (정확한 매칭 + 포함 매칭)
- [x] 위치 기반 검증 (recorded position vs current position)
- [x] 거래 영역 한정 탐색 (성능 최적화)
- [x] 캐싱 시스템 (DOM 스캔 결과 캐시)

### 7-3. 고급 에러 처리 및 검증
- [x] 요소를 찾지 못한 경우 스마트 탐지로 재시도
- [x] 탭 불일치 검증 (Open/Close 탭 확인)
- [x] 텍스트 불일치 검증 (Long/Short 버튼 확인)
- [x] 상세한 디버깅 로그 (액션별 성공/실패 추적)
- [x] 사용자 친화적 에러 메시지

### 7-4. Manual Trading 시스템
- [x] Manual Long / Manual Short 버튼 구현
- [x] 매크로 존재 여부 확인
- [x] Amount 계산값 자동 입력
- [x] 실행 결과 피드백

### 7-5. UI 개선 사항
- [x] 버튼 상태 표시 (has-data, has-macro 클래스)
- [x] 매크로 저장 상태 시각적 피드백
- [x] 실행 중 상태 표시
- [x] 성공/실패 메시지 표시

### 7-6. 실행 테스트
- [x] Long 매크로 실행 테스트 (정상 작동)
- [x] Short 매크로 실행 테스트 (Long/Short 구분 문제 해결)
- [x] 복잡한 시퀀스 테스트 (Open 탭 + Amount + Long/Short)
- [x] 에러 발생 시 처리 확인

**완료 조건**: 녹화한 매크로를 정상적으로 실행함 ✅

---

## 📝 Phase 8: 기술적 지표 계산 (8단계)
**목표**: 볼린저 밴드 등 기술적 지표 계산

### 8-1. 기본 함수 구현
- [ ] 가격 데이터 저장
- [ ] SMA 계산
- [ ] 표준편차 계산
- [ ] 볼린저 밴드 계산

### 8-2. 지표 모듈
- [ ] indicators.js 생성
- [ ] 클래스/함수 구조
- [ ] 데이터 관리

### 8-3. 신호 생성
- [ ] 매수 신호 판별
- [ ] 매도 신호 판별
- [ ] 신호 확인 함수

### 8-4. 테스트
- [ ] 샘플 데이터로 계산
- [ ] 결과가 정확한지 확인
- [ ] 신호가 올바르게 생성되는지 확인

**완료 조건**: 볼린저 밴드 계산 및 신호 생성이 정상 작동

---

## 📝 Phase 9: 자동매매 로직 (9단계)
**목표**: 신호에 따라 자동으로 매매

### 9-1. 거래 로직
- [ ] 신호 확인 주기 설정
- [ ] 매수 신호 시 매크로 실행
- [ ] 매도 신호 시 매크로 실행

### 9-2. 상태 관리
- [ ] 현재 포지션 추적
- [ ] 거래 내역 저장
- [ ] 거래 제어 (시작/중단)

### 9-3. 안전 장치
- [ ] 거래 간격 제한
- [ ] 최대 손실 제한
- [ ] 중복 주문 방지

### 9-4. 테스트
- [ ] 자동매매 시작/중단
- [ ] 신호 발생 시 주문 실행
- [ ] 상태 추적 정확성 확인

**완료 조건**: 신호에 따라 자동으로 매매가 실행됨

---

## 📝 Phase 10: 사용자 인터페이스 완성 (10단계)
**목표**: 모든 기능을 사용할 수 있는 완성된 UI

### 10-1. 설정 페이지
- [ ] 옵션 페이지 구현
- [ ] 전략 설정 UI
- [ ] 매크로 관리 UI

### 10-2. 통계 및 내역
- [ ] 거래 내역 표시
- [ ] 통계 정보 표시
- [ ] 차트/그래프 (선택사항)

### 10-3. 알림 시스템
- [ ] 거래 알림
- [ ] 에러 알림
- [ ] 상태 변경 알림

### 10-4. 최종 테스트
- [ ] 모든 기능 통합 테스트
- [ ] 사용자 시나리오 테스트
- [ ] 에러 처리 확인

**완료 조건**: 모든 기능이 UI를 통해 정상 작동

---

## 📝 Phase 11: 추가 기능 구현 (11단계)
**목표**: 프로젝트 계획의 추가 기능 구현

### 11-1. 다양한 전략
- [ ] RSI 전략
- [ ] MACD 전략
- [ ] 이동평균선 전략
- [ ] 스토캐스틱 전략

### 11-2. 고급 기능
- [ ] 지정가 주문
- [ ] 레버리지 설정
- [ ] 손절/익절 설정

### 11-3. 데이터 분석
- [ ] 백테스팅
- [ ] 성과 분석
- [ ] 최적화 도구

### 11-4. 테스트 및 최적화
- [ ] 성능 최적화
- [ ] 메모리 관리
- [ ] 사용자 경험 개선

---

## 📋 진행 상황 추적
각 단계마다 다음을 기록합니다:
- [ ] 구현 완료 여부
- [ ] 테스트 완료 여부
- [ ] 문제점 및 해결책
- [ ] 다음 단계 계획

---

## ⚠️ 중요 원칙
1. **한 번에 하나씩**: 각 Phase를 완전히 완료한 후 다음으로 진행
2. **테스트 필수**: 각 단계마다 반드시 테스트
3. **일찍 실패**: 문제 발견 시 즉시 중단하고 해결
4. **문서화**: 각 단계의 결과와 문제를 기록

---

## 🎯 현재 진행 단계
**Phase 7 완료** - 하이브리드 매크로 시스템 구현 완료

## 📝 최종 목표
- 모든 Phase를 순차적으로 완료
- 안정적이고 사용 가능한 자동매매 시스템
- 확장 가능한 구조

---

## 📋 완료된 Phase 요약
- ✅ **Phase 1**: 기본 구조 설정 (사이드 패널 형식)
- ✅ **Phase 2**: 사이드 패널 UI 구현 (거래소 선택 포함)
- ✅ **Phase 3**: Chrome APIs 연동 (Storage, Tabs, Messages)
- ✅ **Phase 4**: Content Script 기본 (거래소 감지 및 통신)
- ✅ **Phase 5**: 가격 정보 추출 (Assets, Price, Amount 자동 계산)
- ✅ **Phase 6**: 하이브리드 매크로 녹화 시스템 (스마트 요소 탐지)
- ✅ **Phase 7**: 매크로 실행 시스템 (Long/Short 정확성 보장)

## 🔄 다음 단계
**Phase 8**: 기술적 지표 계산 (볼린저 밴드) 구현 준비

---

## 🎉 주요 보완 사항 (Phase 6-7)

### 🔧 **기술적 개선**
- **하이브리드 요소 탐지**: 셀렉터 + 키워드 + 위치 기반 3중 백업 시스템
- **스마트 셀렉터 생성**: Long/Short 버튼 구분을 위한 nth-child 활용
- **성능 최적화**: Content Script 수동 주입, 이벤트 리스너 최적화
- **텍스트 검증**: 매크로 실행 시 버튼 텍스트 일치 여부 확인

### 🎨 **UI/UX 개선**
- **시각적 피드백**: 매크로 저장 상태 표시 (has-data, has-macro 클래스)
- **Manual Trading**: Long/Short 매크로 수동 테스트 버튼
- **상태 표시**: 녹화 중/실행 중 상태 명확한 표시
- **에러 처리**: 사용자 친화적 에러 메시지 및 가이드

### 🛡️ **안정성 강화**
- **중복 방지**: 같은 CSS 클래스 버튼 구분 로직
- **백그라운드 최적화**: 자동 실행 방지로 브라우저 성능 개선
- **디버깅 강화**: 상세한 콘솔 로그 및 실행 추적
- **에러 복구**: 셀렉터 실패 시 스마트 탐지로 자동 복구

